<Window x:Class="TaskManager.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:TaskManager"
        mc:Ignorable="d"
        Title="タスク管理" Height="600" Width="800"
        Closing="Window_Closing">
    <DockPanel>
        <!-- メニューバー -->
        <Menu DockPanel.Dock="Top">
            <MenuItem Header="設定">
                <MenuItem x:Name="TopMostMenuItem" 
                         Header="最前面に表示" 
                         IsCheckable="True"
                         Click="TopMostMenuItem_Click"/>
            </MenuItem>
            <MenuItem Header="タスク">
                <MenuItem Header="タスクを保存" 
                         Click="SaveTasks_Click"/>
                <MenuItem Header="タスクを読み込む" 
                         Click="LoadTasks_Click"/>
                <Separator/>
                <MenuItem Header="完了済みタスクを表示" 
                         Click="ShowCompletedTasks_Click"/>
            </MenuItem>
        </Menu>

        <!-- メインコンテンツ -->
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="*"/>
                <RowDefinition Height="200"/>
            </Grid.RowDefinitions>

            <!-- Top Pane: Task List -->
            <Border Grid.Row="0" BorderBrush="#DDDDDD" BorderThickness="1" Margin="10">
                <DockPanel>
                    <!-- Add Task Button -->
                    <Button DockPanel.Dock="Top"
                            Content="新規タスク追加"
                            Height="40"
                            Margin="5"
                            Click="AddTask_Click"
                            HorizontalAlignment="Right"
                            Padding="20,0"/>

                    <!-- Task List -->
                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                        <ListBox x:Name="TaskList" 
                                Margin="5"
                                HorizontalContentAlignment="Stretch"
                                SelectionChanged="TaskList_SelectionChanged">
                            <ListBox.ItemContainerStyle>
                                <Style TargetType="ListBoxItem">
                                    <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                                    <Setter Property="Padding" Value="0"/>
                                    <Setter Property="Margin" Value="0,5"/>
                                    <Setter Property="Focusable" Value="True"/>
                                </Style>
                            </ListBox.ItemContainerStyle>
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <Border BorderBrush="#DDDDDD" 
                                            BorderThickness="1" 
                                            CornerRadius="4" 
                                            Padding="10"
                                            Background="#F8F8F8">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                            </Grid.RowDefinitions>

                                            <!-- Task Name -->
                                            <TextBlock Grid.Column="0" 
                                                     Text="{Binding Name}" 
                                                     FontSize="14"
                                                     FontWeight="Bold"
                                                     VerticalAlignment="Center">
                                                <TextBlock.Style>
                                                    <Style TargetType="TextBlock">
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding IsCompleted}" Value="True">
                                                                <Setter Property="TextDecorations" Value="Strikethrough"/>
                                                                <Setter Property="Opacity" Value="0.6"/>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </TextBlock.Style>
                                            </TextBlock>

                                            <!-- Time Information -->
                                            <StackPanel Grid.Column="1" Margin="10,0">
                                                <TextBlock Text="{Binding EstimatedTime, StringFormat='予定: {0:hh\\:mm}'}"
                                                         FontFamily="Consolas"
                                                         FontSize="12"
                                                         Margin="0,2"/>
                                                <TextBlock Text="{Binding ElapsedTime, StringFormat='経過: {0:hh\\:mm}'}"
                                                         FontFamily="Consolas"
                                                         FontSize="12"
                                                         Margin="0,2"/>
                                            </StackPanel>

                                            <!-- Complete Button -->
                                            <Button Grid.Column="2"
                                                    Content="完了"
                                                    Padding="10,5"
                                                    Margin="5,0"
                                                    VerticalAlignment="Top"
                                                    Click="CompleteTask_Click">
                                                <Button.Style>
                                                    <Style TargetType="Button">
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding IsCompleted}" Value="True">
                                                                <Setter Property="Visibility" Value="Collapsed"/>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </Button.Style>
                                            </Button>

                                            <!-- Delete Button -->
                                            <Button Grid.Column="3"
                                                    Content="削除"
                                                    Padding="10,5"
                                                    VerticalAlignment="Top"
                                                    Click="DeleteTask_Click"/>

                                            <!-- Memo (Only visible when selected) -->
                                            <TextBlock Grid.Row="1"
                                                     Grid.ColumnSpan="4"
                                                     Text="{Binding Memo}"
                                                     Margin="0,8,0,0"
                                                     TextWrapping="Wrap"
                                                     Opacity="0.7">
                                                <TextBlock.Style>
                                                    <Style TargetType="TextBlock">
                                                        <Setter Property="Visibility" Value="Collapsed"/>
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type ListBoxItem}}, Path=IsSelected}" Value="True">
                                                                <Setter Property="Visibility" Value="Visible"/>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </TextBlock.Style>
                                            </TextBlock>
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                    </ScrollViewer>
                </DockPanel>
            </Border>

            <!-- Bottom Pane: Stopwatch -->
            <Border Grid.Row="1" BorderBrush="#DDDDDD" BorderThickness="1" Margin="10">
                <Grid Margin="10">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Current Task Name -->
                    <TextBlock x:Name="CurrentTaskName"
                             Text="選択タスク: なし"
                             FontSize="14"
                             HorizontalAlignment="Center"
                             Margin="0,0,0,10"/>

                    <!-- Stopwatch Display -->
                    <StackPanel Grid.Row="1" 
                              Orientation="Horizontal"
                              HorizontalAlignment="Center"
                              Margin="0,0,0,20">
                        <TextBlock x:Name="StopwatchDisplay" 
                                 Text="00:00:00"
                                 FontSize="48"/>
                        <TextBlock x:Name="StopwatchMilliseconds"
                                 Text=".0"
                                 FontSize="24"
                                 VerticalAlignment="Bottom"
                                 Margin="0,0,0,8"/>
                    </StackPanel>

                    <!-- Control Buttons -->
                    <StackPanel Grid.Row="2" 
                              Orientation="Horizontal" 
                              HorizontalAlignment="Center">
                        <Button x:Name="StartButton"
                                Content="開始"
                                Width="100"
                                Height="40"
                                Margin="10,0"
                                Click="StartButton_Click"/>
                        <Button x:Name="StopButton"
                                Content="停止"
                                Width="100"
                                Height="40"
                                Margin="10,0"
                                Click="StopButton_Click"/>
                    </StackPanel>
                </Grid>
            </Border>
        </Grid>
    </DockPanel>
</Window>
