# フェーズ1 詳細作業計画: サービスレイヤーの整理

## 1. 準備作業
- [ ] 作業用ブランチの作成 (`feature/phase1-service-layer`)
- [ ] 既存コードのバックアップ作成
- [ ] 必要なNuGetパッケージの追加
  - Microsoft.Extensions.DependencyInjection
  - Microsoft.Extensions.Logging

## 2. インターフェース定義 (Day 1)
### ITaskStateManager
- [ ] タスク状態遷移の定義
- [ ] タスクコレクション管理の抽象化
- [ ] 状態変更イベントの定義

### ITaskPersistence
- [ ] データ保存操作の定義
- [ ] データ読み込み操作の定義
- [ ] バックアップ操作の定義

### ITaskValidator
- [ ] タスクバリデーションルールの定義
- [ ] カスタムバリデーション拡張ポイントの定義

## 3. サービス実装 (Day 1-2)
### TaskStateManagerService
- [ ] 状態遷移ロジックの実装
- [ ] コレクション操作の実装
- [ ] イベント通知の実装

### TaskPersistenceService
- [ ] JSON永続化の実装
- [ ] ファイル操作の例外処理
- [ ] 自動バックアップの基盤実装

### TaskValidationService
- [ ] 基本バリデーションの実装
- [ ] カスタムバリデーションの実装
- [ ] バリデーションメッセージの管理

## 4. 依存性注入の設定 (Day 2)
- [ ] App.xaml.csでのDIコンテナ設定
- [ ] サービス登録の実装
- [ ] スコープ管理の実装

## 5. 既存コードの移行 (Day 2-3)
- [ ] TaskManagerServiceの責務分割
- [ ] 新しいサービスへの段階的な移行
- [ ] 参照の更新

## 6. テストとバリデーション (Day 3)
- [ ] 単体テストの作成
- [ ] 結合テストの作成
- [ ] 手動テストの実施

## 検証項目
1. 既存機能の動作確認
   - タスク作成/編集/削除
   - 状態遷移
   - データ永続化
   
2. エラー処理の確認
   - バリデーションエラー
   - ファイル操作エラー
   - 状態遷移エラー

3. パフォーマンス確認
   - メモリ使用量
   - 応答性能
   - ファイル操作速度

## ロールバック手順
1. 作業ブランチの破棄
2. バックアップからの復元
3. NuGetパッケージの構成を元に戻す

## 成功基準
- [ ] すべてのユニットテストが成功
- [ ] 既存機能が正常に動作
- [ ] エラー処理が適切に機能
- [ ] コードレビューの承認
- [ ] パフォーマンス要件の充足

## リスク対策
1. 段階的な移行による影響範囲の制限
2. 各ステップでのバックアップ作成
3. 詳細なログ記録による追跡可能性の確保
4. レビュー時の重点確認項目の設定